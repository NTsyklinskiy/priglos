'use strict';

class Component {
  constructor() {
    this.getElementToId();
  }

  getElementToId(id) {
    let element;

    if (id === '') {
      element = window;
    } else {
      element = document.getElementById(id);
    }

    return element;
  }

  static fonAnim() {
    const wrapper = document.querySelector('.wrapper');
    const element = document.createElement('span');

    function toStyle(col) {
      let style = [];

      for (let k = 0; k < col; k++) {
        let widthHeight = Math.floor(Math.random() * (10 - 1) + 1);
        let i = Math.floor(Math.random() * 100);
        style.push({
          left: `${i}%`,
          width: `${widthHeight}%`,
          height: ` ${widthHeight}%`
        });
      }

      return style;
    }

    function cloneElement(element) {
      let cloneElement = element.cloneNode(true);
      cloneElement.className = 'heartFons';
      return cloneElement;
    }

    const marup = toStyle(20).map(styles => {
      const el = cloneElement(element);
      const secAnim = Math.floor(Math.random() * (40 - 15) + 15);
      const minPlus = secAnim % 2 === 0 ? '-' : '';
      el.style.left = styles['left'];
      el.style.height = styles['height'];
      el.style.width = styles['width'];
      el.animate({
        top: ['-10%', '100%'],
        transform: ['rotate(0deg)', `rotate(${minPlus}${Math.floor(Math.random() * 360)}deg)`],
        easing: 'linear'
      }, {
        delay: +`${Math.floor(Math.random() * 15) * 1000}`,
        duration: +`${secAnim * 1000}`,
        iterations: Infinity
      });
      return el;
    });
    marup.forEach(mark => {
      wrapper.insertAdjacentElement('afterbegin', mark);
    });
  }

}

class App {
  static init() {
    Component.fonAnim();
    const navHover = new Listeners('navigation', 'mouseover mouseout', '0.5 1');
    navHover.listenerHeader();
    const navClick = new Listeners('header', 'click');
    navClick.listenerHeader();
    const navScroll = new Listeners('', 'scroll', 'timer .priglos');
    navScroll.listenerHeader();
  }

}

class Listeners extends Component {
  constructor(id, type, param) {
    super();
    this.id = id;
    this.type = type;
    this.param = param;
  }

  navHover(ob, e) {
    // console.log(ob, e)
    if (e.target.classList.contains('navigation__link')) {
      const link = e.target;
      const siblings = link.closest('.navigation__items').querySelectorAll('.navigation__link');
      siblings.forEach(el => {
        if (el !== link) {
          el.style.opacity = ob;
        }
      });
    }
  }

  navClick(e) {
    e.preventDefault();
    const elAll = document.querySelectorAll('.navigation__link');
    const elRect = [];

    for (const el of elAll) {
      const attr = el.getAttribute('href');
      console.log(attr);

      if (attr) {
        const rect = document.querySelector(attr).getBoundingClientRect();
        elRect.push([attr, rect]);
      }
    }

    elRect.forEach(elR => {
      if (e.target.getAttribute('href') === elR[0]) {
        window.scrollTo({
          left: elR[1].left + window.pageXOffset,
          top: elR[1].top + window.pageYOffset,
          behavior: 'smooth'
        });
      }
    });
  }

  navScroll(id, param, e) {
    const value = window.scrollY;
    const docValue = document.getElementById(id).offsetTop;
    const elHeart = document.querySelector(param);
    if (value > docValue) elHeart.classList.add('focus');
  }

  listenerHeader() {
    const el = this.getElementToId(this.id);
    this.type.split(' ').forEach(t => {
      if (t === 'mouseover') {
        el.addEventListener(t, this.navHover.bind(null, this.param.split(' ')[0]));
      } else if (t === 'mouseout') {
        el.addEventListener(t, this.navHover.bind(null, this.param.split(' ')[1]));
      } else if (t === 'click') {
        el.addEventListener(t, this.navClick.bind(this));
      } else if (t === 'scroll') {
        window.addEventListener(t, this.navScroll.bind(null, this.param.split(' ')[0], this.param.split(' ')[1]));
      }
    });
  }

}

Timer.startLogOutTimer();
App.init(); // importNode(element, true)   cloneNode(true) replaceWith 
// window.addEventListener('scroll', (e)=> {
//   console.log('Current scroll (X/Y', window.pageYOffset,window.scrollY);
//   // console.log(elHeart)
// })